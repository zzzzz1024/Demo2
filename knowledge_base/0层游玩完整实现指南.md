# SillyTavern 0å±‚æ¸¸ç©å®Œæ•´å®ç°æŒ‡å—

## ä»€ä¹ˆæ˜¯0å±‚æ¸¸ç©

0å±‚æ¸¸ç©æ˜¯æŒ‡ç”¨æˆ·æ— éœ€è¿›è¡Œå¤æ‚çš„æ‰‹åŠ¨æ“ä½œï¼Œè§’è‰²å¡èƒ½å¤Ÿè‡ªåŠ¨å¤„ç†æ¸¸æˆçŠ¶æ€ã€å“åº”äº¤äº’ï¼Œå¹¶æä¾›æµç•…çš„æ¸¸æˆä½“éªŒçš„è®¾è®¡ç†å¿µã€‚ç”¨æˆ·åªéœ€è¦è¿›è¡Œæœ€åŸºæœ¬çš„å¯¹è¯äº¤äº’ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†ï¼š

- çŠ¶æ€ç®¡ç†ï¼ˆHPã€MPã€ç»éªŒå€¼ç­‰ï¼‰
- ç‰©å“ç®¡ç†ï¼ˆèƒŒåŒ…ã€è£…å¤‡ã€é‡‘å¸ç­‰ï¼‰
- è¿›åº¦è·Ÿè¸ªï¼ˆä»»åŠ¡ã€å‰§æƒ…èŠ‚ç‚¹ç­‰ï¼‰
- åŠ¨æ€å†…å®¹ç”Ÿæˆ
- æ™ºèƒ½å“åº”ç³»ç»Ÿ

## æ ¸å¿ƒå®ç°ç»„ä»¶

### 1. é…’é¦†åŠ©æ‰‹ (TavernHelper) é›†æˆ

#### åŸºç¡€è®¾ç½®
```javascript
// åˆå§‹åŒ–TavernHelperå˜é‡ç®¡ç†
TavernHelper.initialize({
    globalScope: true,
    characterScope: true,
    sessionScope: true
});

// è®¾ç½®é»˜è®¤å˜é‡
TavernHelper.setVariable('char_hp', 100);
TavernHelper.setVariable('char_max_hp', 100);
TavernHelper.setVariable('char_mp', 100);
TavernHelper.setVariable('char_max_mp', 100);
TavernHelper.setVariable('char_level', 1);
TavernHelper.setVariable('char_exp', 0);
TavernHelper.setVariable('char_gold', 100);
```

#### çŠ¶æ€ç›‘å¬ç³»ç»Ÿ
```javascript
// ç›‘å¬æ¶ˆæ¯å˜åŒ–å¹¶è‡ªåŠ¨æ›´æ–°çŠ¶æ€
TavernHelper.subscribe('message_received', (message) => {
    updateGameState(message);
});

function updateGameState(message) {
    const content = message.content;
    
    // è‡ªåŠ¨è§£æä¼¤å®³
    const damagePattern = /å—åˆ°äº†?(\d+)ç‚¹?ä¼¤å®³/g;
    const damageMatch = content.match(damagePattern);
    if (damageMatch) {
        const damage = parseInt(damageMatch[1]);
        const currentHp = TavernHelper.getVariable('char_hp');
        const newHp = Math.max(0, currentHp - damage);
        TavernHelper.setVariable('char_hp', newHp);
        
        // è§¦å‘æ­»äº¡æ£€æµ‹
        if (newHp === 0) {
            triggerDeathSequence();
        }
    }
    
    // è‡ªåŠ¨è§£ææ²»ç–—
    const healPattern = /æ¢å¤äº†?(\d+)ç‚¹?ç”Ÿå‘½/g;
    const healMatch = content.match(healPattern);
    if (healMatch) {
        const heal = parseInt(healMatch[1]);
        const currentHp = TavernHelper.getVariable('char_hp');
        const maxHp = TavernHelper.getVariable('char_max_hp');
        TavernHelper.setVariable('char_hp', Math.min(maxHp, currentHp + heal));
    }
    
    // è‡ªåŠ¨è§£æç»éªŒè·å¾—
    const expPattern = /è·å¾—äº†?(\d+)ç‚¹?ç»éªŒ/g;
    const expMatch = content.match(expPattern);
    if (expMatch) {
        const exp = parseInt(expMatch[1]);
        const currentExp = TavernHelper.getVariable('char_exp');
        const newExp = currentExp + exp;
        TavernHelper.setVariable('char_exp', newExp);
        
        // æ£€æŸ¥å‡çº§
        checkLevelUp(newExp);
    }
}
```

### 2. MagVarUpdate å˜é‡ç®¡ç†

#### é«˜çº§å˜é‡ç³»ç»Ÿ
```yaml
# è§’è‰²çŠ¶æ€å˜é‡å®šä¹‰
variables:
  # åŸºç¡€å±æ€§
  char_hp: 
    type: number
    min: 0
    max: "{{char_max_hp}}"
    default: 100
    description: "è§’è‰²å½“å‰ç”Ÿå‘½å€¼"
    
  char_mp:
    type: number
    min: 0
    max: "{{char_max_mp}}"
    default: 100
    description: "è§’è‰²å½“å‰é­”æ³•å€¼"
    
  char_level:
    type: number
    min: 1
    max: 100
    default: 1
    description: "è§’è‰²ç­‰çº§"
    
  # çŠ¶æ€æ•ˆæœ
  char_status_effects:
    type: array
    default: []
    description: "å½“å‰çŠ¶æ€æ•ˆæœåˆ—è¡¨"
    
  # èƒŒåŒ…ç³»ç»Ÿ
  inventory_items:
    type: object
    default: {}
    description: "èƒŒåŒ…ç‰©å“"
    
  inventory_capacity:
    type: number
    default: 20
    description: "èƒŒåŒ…å®¹é‡"

# è‡ªåŠ¨åŒ–è§„åˆ™
automation_rules:
  # HPè‡ªåŠ¨æ¢å¤
  - trigger: "every_turn"
    condition: "{{char_hp}} < {{char_max_hp}} && !{{has_status('æ¯’')}}"
    action: "increment_variable('char_hp', 1)"
    
  # MPè‡ªåŠ¨æ¢å¤
  - trigger: "every_turn"
    condition: "{{char_mp}} < {{char_max_mp}}"
    action: "increment_variable('char_mp', 2)"
    
  # çŠ¶æ€æ•ˆæœæŒç»­æ—¶é—´
  - trigger: "turn_end"
    action: "process_status_effects()"
```

#### åŠ¨æ€å†…å®¹ç”Ÿæˆ
```javascript
// åŸºäºçŠ¶æ€çš„åŠ¨æ€æè¿°
function generateStatusDescription() {
    const hp = TavernHelper.getVariable('char_hp');
    const maxHp = TavernHelper.getVariable('char_max_hp');
    const hpPercent = hp / maxHp;
    
    let statusDesc = '';
    
    if (hpPercent > 0.8) {
        statusDesc = 'ç²¾ç¥é¥±æ»¡ï¼ŒçŠ¶æ€è‰¯å¥½';
    } else if (hpPercent > 0.5) {
        statusDesc = 'ç•¥æ˜¾ç–²æƒ«ï¼Œä½†ä»èƒ½ç»§ç»­æˆ˜æ–—';
    } else if (hpPercent > 0.2) {
        statusDesc = 'ä¼¤åŠ¿è¾ƒé‡ï¼Œè¡ŒåŠ¨å—åˆ°å½±å“';
    } else {
        statusDesc = 'ç”Ÿå‘½å±é™©ï¼Œæ€¥éœ€æ²»ç–—';
    }
    
    return statusDesc;
}

// æ™ºèƒ½ç‰©å“æ¨è
function recommendItems() {
    const hp = TavernHelper.getVariable('char_hp');
    const mp = TavernHelper.getVariable('char_mp');
    const items = TavernHelper.getVariable('inventory_items');
    
    const recommendations = [];
    
    if (hp < 50 && items.healing_potion > 0) {
        recommendations.push('å»ºè®®ä½¿ç”¨æ²»ç–—è¯æ°´æ¢å¤ç”Ÿå‘½å€¼');
    }
    
    if (mp < 30 && items.mana_potion > 0) {
        recommendations.push('å»ºè®®ä½¿ç”¨é­”æ³•è¯æ°´æ¢å¤æ³•åŠ›å€¼');
    }
    
    return recommendations;
}
```

### 3. ä¸–ç•Œä¹¦é›†æˆ

#### åŠ¨æ€ä¸–ç•Œä¹¦æ¡ç›®
```yaml
# çŠ¶æ€ç›¸å…³çš„ä¸–ç•Œä¹¦æ¡ç›®
entries:
  - keys: ["HP", "ç”Ÿå‘½å€¼", "è¡€é‡"]
    content: |
      {{char_name}}çš„å½“å‰ç”Ÿå‘½å€¼ï¼š{{char_hp}}/{{char_max_hp}}
      {{#if (lt char_hp 30)}}
      âš ï¸ ç”Ÿå‘½å€¼å±é™©ï¼éœ€è¦ç«‹å³æ²»ç–—ï¼
      {{/if}}
      {{generateStatusDescription()}}
    
  - keys: ["çŠ¶æ€", "å±æ€§", "è§’è‰²é¢æ¿"]
    content: |
      === è§’è‰²çŠ¶æ€é¢æ¿ ===
      å§“åï¼š{{char_name}}
      ç­‰çº§ï¼š{{char_level}} (ç»éªŒå€¼ï¼š{{char_exp}}/{{getNextLevelExp()}})
      ç”Ÿå‘½å€¼ï¼š{{char_hp}}/{{char_max_hp}}
      é­”æ³•å€¼ï¼š{{char_mp}}/{{char_max_mp}}
      é‡‘å¸ï¼š{{char_gold}}
      
      å½“å‰çŠ¶æ€æ•ˆæœï¼š
      {{#each char_status_effects}}
      - {{this.name}}ï¼ˆå‰©ä½™{{this.duration}}å›åˆï¼‰
      {{/each}}
      
      {{#if (recommendItems)}}
      === å»ºè®®æ“ä½œ ===
      {{#each (recommendItems)}}
      ğŸ’¡ {{this}}
      {{/each}}
      {{/if}}
    
  - keys: ["èƒŒåŒ…", "ç‰©å“", "é“å…·"]
    content: |
      === èƒŒåŒ…å†…å®¹ ===
      å®¹é‡ï¼š{{getItemCount()}}/{{inventory_capacity}}
      
      {{#each inventory_items}}
      {{@key}}: {{this}}ä¸ª
      {{/each}}
      
      {{#if (gt (getItemCount) (mult inventory_capacity 0.8))}}
      âš ï¸ èƒŒåŒ…æ¥è¿‘æ»¡è½½ï¼Œå»ºè®®æ•´ç†ç‰©å“
      {{/if}}
```

### 4. æ­£åˆ™è¡¨è¾¾å¼è‡ªåŠ¨åŒ–

#### æ™ºèƒ½è¾“å…¥å¤„ç†
```javascript
// æ­£åˆ™æ›¿æ¢è§„åˆ™
const autoReplacements = [
    // å¿«æ·æŒ‡ä»¤
    {
        find: /^\.hp$/i,
        replace: () => {
            const hp = TavernHelper.getVariable('char_hp');
            const maxHp = TavernHelper.getVariable('char_max_hp');
            return `å½“å‰ç”Ÿå‘½å€¼ï¼š${hp}/${maxHp}`;
        }
    },
    
    {
        find: /^\.status$/i,
        replace: () => {
            return TavernHelper.getVariable('status_panel_content');
        }
    },
    
    {
        find: /^\.use\s+(.+)$/i,
        replace: (match, itemName) => {
            return useItem(itemName);
        }
    },
    
    // è‡ªåŠ¨æ•°å€¼è§£æ
    {
        find: /æ”»å‡»(.+)/i,
        replace: (match, target) => {
            const damage = rollDamage();
            return `${match}ï¼Œé€ æˆ${damage}ç‚¹ä¼¤å®³ï¼`;
        }
    },
    
    {
        find: /è´­ä¹°(.+)/i,
        replace: (match, item) => {
            return processPurchase(item);
        }
    }
];

// ç‰©å“ä½¿ç”¨ç³»ç»Ÿ
function useItem(itemName) {
    const items = TavernHelper.getVariable('inventory_items');
    
    if (!items[itemName] || items[itemName] <= 0) {
        return `æ²¡æœ‰${itemName}å¯ä»¥ä½¿ç”¨`;
    }
    
    // å‡å°‘ç‰©å“æ•°é‡
    items[itemName]--;
    TavernHelper.setVariable('inventory_items', items);
    
    // åº”ç”¨ç‰©å“æ•ˆæœ
    switch(itemName) {
        case 'æ²»ç–—è¯æ°´':
            const currentHp = TavernHelper.getVariable('char_hp');
            const maxHp = TavernHelper.getVariable('char_max_hp');
            const healAmount = 50;
            const newHp = Math.min(maxHp, currentHp + healAmount);
            TavernHelper.setVariable('char_hp', newHp);
            return `ä½¿ç”¨äº†æ²»ç–—è¯æ°´ï¼Œæ¢å¤äº†${newHp - currentHp}ç‚¹ç”Ÿå‘½å€¼ï¼`;
            
        case 'é­”æ³•è¯æ°´':
            const currentMp = TavernHelper.getVariable('char_mp');
            const maxMp = TavernHelper.getVariable('char_max_mp');
            const manaAmount = 30;
            const newMp = Math.min(maxMp, currentMp + manaAmount);
            TavernHelper.setVariable('char_mp', newMp);
            return `ä½¿ç”¨äº†é­”æ³•è¯æ°´ï¼Œæ¢å¤äº†${newMp - currentMp}ç‚¹é­”æ³•å€¼ï¼`;
            
        default:
            return `ä½¿ç”¨äº†${itemName}`;
    }
}
```

### 5. å‰ç«¯UIé›†æˆ

#### çŠ¶æ€æ˜¾ç¤ºç»„ä»¶
```vue
<template>
  <div class="game-status-panel">
    <div class="character-stats">
      <div class="stat-bar hp-bar">
        <label>HP</label>
        <div class="bar-container">
          <div class="bar-fill" :style="{ width: hpPercent + '%' }"></div>
          <span class="bar-text">{{ charHp }}/{{ charMaxHp }}</span>
        </div>
      </div>
      
      <div class="stat-bar mp-bar">
        <label>MP</label>
        <div class="bar-container">
          <div class="bar-fill" :style="{ width: mpPercent + '%' }"></div>
          <span class="bar-text">{{ charMp }}/{{ charMaxMp }}</span>
        </div>
      </div>
      
      <div class="level-info">
        <span>ç­‰çº§ {{ charLevel }}</span>
        <div class="exp-bar">
          <div class="bar-fill" :style="{ width: expPercent + '%' }"></div>
        </div>
      </div>
    </div>
    
    <div class="quick-actions">
      <button @click="useItem('æ²»ç–—è¯æ°´')" :disabled="!hasItem('æ²»ç–—è¯æ°´')">
        æ²»ç–—è¯æ°´ ({{ getItemCount('æ²»ç–—è¯æ°´') }})
      </button>
      <button @click="useItem('é­”æ³•è¯æ°´')" :disabled="!hasItem('é­”æ³•è¯æ°´')">
        é­”æ³•è¯æ°´ ({{ getItemCount('é­”æ³•è¯æ°´') }})
      </button>
      <button @click="showInventory">èƒŒåŒ…</button>
      <button @click="showStatus">çŠ¶æ€</button>
    </div>
    
    <div class="status-effects" v-if="statusEffects.length > 0">
      <div v-for="effect in statusEffects" :key="effect.name" class="effect-icon">
        {{ effect.icon }} {{ effect.duration }}
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue';

// å“åº”å¼æ•°æ®
const charHp = ref(100);
const charMaxHp = ref(100);
const charMp = ref(100);
const charMaxMp = ref(100);
const charLevel = ref(1);
const charExp = ref(0);
const statusEffects = ref([]);
const inventory = ref({});

// è®¡ç®—å±æ€§
const hpPercent = computed(() => (charHp.value / charMaxHp.value) * 100);
const mpPercent = computed(() => (charMp.value / charMaxMp.value) * 100);
const expPercent = computed(() => {
  const nextLevelExp = charLevel.value * 100;
  return (charExp.value / nextLevelExp) * 100;
});

// æ–¹æ³•
function useItem(itemName: string) {
  // é€šè¿‡TavernHelperä½¿ç”¨ç‰©å“
  const result = TavernHelper.executeCommand(`use ${itemName}`);
  updateStats();
}

function hasItem(itemName: string) {
  return (inventory.value[itemName] || 0) > 0;
}

function getItemCount(itemName: string) {
  return inventory.value[itemName] || 0;
}

function updateStats() {
  // ä»TavernHelperè·å–æœ€æ–°çŠ¶æ€
  charHp.value = TavernHelper.getVariable('char_hp');
  charMaxHp.value = TavernHelper.getVariable('char_max_hp');
  charMp.value = TavernHelper.getVariable('char_mp');
  charMaxMp.value = TavernHelper.getVariable('char_max_mp');
  charLevel.value = TavernHelper.getVariable('char_level');
  charExp.value = TavernHelper.getVariable('char_exp');
  statusEffects.value = TavernHelper.getVariable('char_status_effects') || [];
  inventory.value = TavernHelper.getVariable('inventory_items') || {};
}

// ç›‘å¬å˜é‡å˜åŒ–
onMounted(() => {
  updateStats();
  
  // è®¢é˜…å˜é‡å˜åŒ–äº‹ä»¶
  TavernHelper.subscribe('variable_changed', (event) => {
    if (event.name.startsWith('char_') || event.name.startsWith('inventory_')) {
      updateStats();
    }
  });
});
</script>

<style scoped>
.game-status-panel {
  background: #2c3e50;
  color: white;
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 10px;
}

.stat-bar {
  margin-bottom: 10px;
}

.bar-container {
  position: relative;
  background: #34495e;
  height: 20px;
  border-radius: 10px;
  overflow: hidden;
}

.bar-fill {
  height: 100%;
  transition: width 0.3s ease;
}

.hp-bar .bar-fill {
  background: linear-gradient(90deg, #e74c3c, #c0392b);
}

.mp-bar .bar-fill {
  background: linear-gradient(90deg, #3498db, #2980b9);
}

.bar-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 12px;
  font-weight: bold;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
}

.quick-actions {
  display: flex;
  gap: 10px;
  margin-top: 15px;
}

.quick-actions button {
  padding: 8px 12px;
  border: none;
  border-radius: 4px;
  background: #3498db;
  color: white;
  cursor: pointer;
  font-size: 12px;
}

.quick-actions button:disabled {
  background: #7f8c8d;
  cursor: not-allowed;
}

.status-effects {
  display: flex;
  gap: 5px;
  margin-top: 10px;
}

.effect-icon {
  background: rgba(0,0,0,0.3);
  padding: 5px;
  border-radius: 4px;
  font-size: 12px;
}
</style>
```

#### æ™ºèƒ½æç¤ºç³»ç»Ÿ
```javascript
// æ™ºèƒ½æç¤ºç»„ä»¶
class SmartSuggestionSystem {
    constructor() {
        this.suggestions = [];
        this.setupEventListeners();
    }
    
    setupEventListeners() {
        // ç›‘å¬ç”¨æˆ·è¾“å…¥
        TavernHelper.subscribe('user_input_start', () => {
            this.generateSuggestions();
        });
        
        // ç›‘å¬çŠ¶æ€å˜åŒ–
        TavernHelper.subscribe('variable_changed', (event) => {
            this.updateSuggestions(event);
        });
    }
    
    generateSuggestions() {
        const suggestions = [];
        
        // åŸºäºå½“å‰çŠ¶æ€ç”Ÿæˆå»ºè®®
        const hp = TavernHelper.getVariable('char_hp');
        const maxHp = TavernHelper.getVariable('char_max_hp');
        const mp = TavernHelper.getVariable('char_mp');
        const items = TavernHelper.getVariable('inventory_items');
        
        // ç”Ÿå‘½å€¼å»ºè®®
        if (hp < maxHp * 0.3 && items.healing_potion > 0) {
            suggestions.push({
                text: 'ä½¿ç”¨æ²»ç–—è¯æ°´',
                action: '.use æ²»ç–—è¯æ°´',
                priority: 'high',
                icon: 'ğŸ©¹'
            });
        }
        
        // æ³•åŠ›å€¼å»ºè®®
        if (mp < 20 && items.mana_potion > 0) {
            suggestions.push({
                text: 'ä½¿ç”¨é­”æ³•è¯æ°´',
                action: '.use é­”æ³•è¯æ°´',
                priority: 'medium',
                icon: 'ğŸ§ª'
            });
        }
        
        // æ¢ç´¢å»ºè®®
        if (hp > maxHp * 0.8 && mp > 50) {
            suggestions.push({
                text: 'æ¢ç´¢æ–°åŒºåŸŸ',
                action: 'æˆ‘æƒ³æ¢ç´¢å‘¨å›´çš„ç¯å¢ƒ',
                priority: 'low',
                icon: 'ğŸ—ºï¸'
            });
        }
        
        this.displaySuggestions(suggestions);
    }
    
    displaySuggestions(suggestions) {
        // åœ¨UIä¸­æ˜¾ç¤ºå»ºè®®
        const container = document.getElementById('suggestions-container');
        if (!container) return;
        
        container.innerHTML = '';
        
        suggestions.forEach(suggestion => {
            const button = document.createElement('button');
            button.className = `suggestion-button priority-${suggestion.priority}`;
            button.innerHTML = `${suggestion.icon} ${suggestion.text}`;
            button.onclick = () => this.applySuggestion(suggestion);
            container.appendChild(button);
        });
    }
    
    applySuggestion(suggestion) {
        // åº”ç”¨å»ºè®®
        const inputField = document.querySelector('#user-input textarea');
        if (inputField) {
            inputField.value = suggestion.action;
            inputField.dispatchEvent(new Event('input'));
        }
    }
}
```

## æœ€ä½³å®è·µæŒ‡å—

### 1. å˜é‡å‘½åè§„èŒƒ
- **è§’è‰²å±æ€§**: `char_*` (å¦‚ `char_hp`, `char_level`)
- **ç‰©å“ç³»ç»Ÿ**: `inventory_*` (å¦‚ `inventory_items`, `inventory_capacity`)
- **æ¸¸æˆçŠ¶æ€**: `game_*` (å¦‚ `game_location`, `game_difficulty`)
- **ç³»ç»Ÿè®¾ç½®**: `sys_*` (å¦‚ `sys_auto_save`, `sys_notifications`)

### 2. çŠ¶æ€ç®¡ç†åŸåˆ™
- å§‹ç»ˆéªŒè¯æ•°å€¼èŒƒå›´ï¼ˆHPä¸èƒ½è¶…è¿‡æœ€å¤§å€¼ï¼‰
- å®ç°çŠ¶æ€æŒä¹…åŒ–ï¼ˆè·¨ä¼šè¯ä¿å­˜ï¼‰
- æä¾›çŠ¶æ€æ¢å¤æœºåˆ¶ï¼ˆå‡ºé”™æ—¶å›æ»šï¼‰
- è®°å½•çŠ¶æ€å˜åŒ–å†å²ï¼ˆç”¨äºè°ƒè¯•ï¼‰

### 3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- æä¾›å³æ—¶åé¦ˆï¼ˆçŠ¶æ€å˜åŒ–åŠ¨ç”»ï¼‰
- æ™ºèƒ½å»ºè®®ç³»ç»Ÿï¼ˆåŸºäºå½“å‰çŠ¶æ€ï¼‰
- é”™è¯¯é¢„é˜²ï¼ˆç¦ç”¨ä¸å¯ç”¨æ“ä½œï¼‰
- è¿›åº¦å¯è§†åŒ–ï¼ˆç»éªŒæ¡ã€ç”Ÿå‘½æ¡ï¼‰

### 4. æ€§èƒ½ä¼˜åŒ–
- æ‰¹é‡æ›´æ–°å˜é‡ï¼ˆå‡å°‘äº‹ä»¶è§¦å‘ï¼‰
- ç¼“å­˜è®¡ç®—ç»“æœï¼ˆé¿å…é‡å¤è®¡ç®—ï¼‰
- å¼‚æ­¥å¤„ç†ï¼ˆä¸é˜»å¡UIï¼‰
- å†…å­˜ç®¡ç†ï¼ˆåŠæ—¶æ¸…ç†æ— ç”¨æ•°æ®ï¼‰

## è°ƒè¯•å’Œæµ‹è¯•

### 1. è°ƒè¯•å·¥å…·
```javascript
// è°ƒè¯•é¢æ¿
class DebugPanel {
    constructor() {
        this.createPanel();
        this.setupEventListeners();
    }
    
    createPanel() {
        const panel = document.createElement('div');
        panel.id = 'debug-panel';
        panel.innerHTML = `
            <h3>è°ƒè¯•é¢æ¿</h3>
            <div class="debug-section">
                <h4>å˜é‡ç›‘æ§</h4>
                <div id="variable-monitor"></div>
            </div>
            <div class="debug-section">
                <h4>äº‹ä»¶æ—¥å¿—</h4>
                <div id="event-log"></div>
            </div>
            <div class="debug-section">
                <h4>å¿«é€Ÿæµ‹è¯•</h4>
                <button onclick="debugPanel.testDamage()">æµ‹è¯•ä¼¤å®³</button>
                <button onclick="debugPanel.testHealing()">æµ‹è¯•æ²»ç–—</button>
                <button onclick="debugPanel.testLevelUp()">æµ‹è¯•å‡çº§</button>
            </div>
        `;
        document.body.appendChild(panel);
    }
    
    testDamage() {
        const currentHp = TavernHelper.getVariable('char_hp');
        TavernHelper.setVariable('char_hp', Math.max(0, currentHp - 25));
        this.log('æµ‹è¯•ä¼¤å®³: -25 HP');
    }
    
    testHealing() {
        const currentHp = TavernHelper.getVariable('char_hp');
        const maxHp = TavernHelper.getVariable('char_max_hp');
        TavernHelper.setVariable('char_hp', Math.min(maxHp, currentHp + 30));
        this.log('æµ‹è¯•æ²»ç–—: +30 HP');
    }
    
    testLevelUp() {
        const currentLevel = TavernHelper.getVariable('char_level');
        TavernHelper.setVariable('char_level', currentLevel + 1);
        TavernHelper.setVariable('char_exp', 0);
        this.log('æµ‹è¯•å‡çº§: ç­‰çº§ +1');
    }
    
    log(message) {
        const logContainer = document.getElementById('event-log');
        const logEntry = document.createElement('div');
        logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        logContainer.appendChild(logEntry);
        logContainer.scrollTop = logContainer.scrollHeight;
    }
}

// å¯ç”¨è°ƒè¯•é¢æ¿
const debugPanel = new DebugPanel();
```

### 2. è‡ªåŠ¨åŒ–æµ‹è¯•
```javascript
// æµ‹è¯•å¥—ä»¶
class TestSuite {
    constructor() {
        this.tests = [];
        this.setupTests();
    }
    
    setupTests() {
        // çŠ¶æ€ç®¡ç†æµ‹è¯•
        this.addTest('HPè¾¹ç•Œæµ‹è¯•', () => {
            TavernHelper.setVariable('char_hp', 150);
            const hp = TavernHelper.getVariable('char_hp');
            const maxHp = TavernHelper.getVariable('char_max_hp');
            return hp <= maxHp;
        });
        
        this.addTest('è´Ÿæ•°HPé˜²æŠ¤', () => {
            TavernHelper.setVariable('char_hp', -10);
            const hp = TavernHelper.getVariable('char_hp');
            return hp >= 0;
        });
        
        // ç‰©å“ç³»ç»Ÿæµ‹è¯•
        this.addTest('ç‰©å“ä½¿ç”¨æµ‹è¯•', () => {
            const items = { healing_potion: 5 };
            TavernHelper.setVariable('inventory_items', items);
            
            const result = useItem('healing_potion');
            const newItems = TavernHelper.getVariable('inventory_items');
            
            return newItems.healing_potion === 4 && result.includes('æ¢å¤');
        });
    }
    
    addTest(name, testFunction) {
        this.tests.push({ name, test: testFunction });
    }
    
    runAllTests() {
        let passed = 0;
        let failed = 0;
        
        console.log('å¼€å§‹è¿è¡Œæµ‹è¯•å¥—ä»¶...');
        
        this.tests.forEach(({ name, test }) => {
            try {
                const result = test();
                if (result) {
                    console.log(`âœ… ${name}: é€šè¿‡`);
                    passed++;
                } else {
                    console.log(`âŒ ${name}: å¤±è´¥`);
                    failed++;
                }
            } catch (error) {
                console.log(`âŒ ${name}: é”™è¯¯ - ${error.message}`);
                failed++;
            }
        });
        
        console.log(`æµ‹è¯•å®Œæˆ: ${passed} é€šè¿‡, ${failed} å¤±è´¥`);
        return { passed, failed };
    }
}

// è¿è¡Œæµ‹è¯•
const testSuite = new TestSuite();
testSuite.runAllTests();
```

## éƒ¨ç½²å’Œç»´æŠ¤

### 1. ç‰ˆæœ¬ç®¡ç†
```yaml
# version.yaml
version: "1.0.0"
compatibility:
  sillytavern: ">=1.10.0"
  tavernhelper: ">=2.0.0"
  magvarupdate: ">=1.5.0"

features:
  - automatic_state_management
  - smart_suggestions
  - inventory_system
  - level_progression
  - status_effects

changelog:
  "1.0.0":
    - "åˆå§‹ç‰ˆæœ¬å‘å¸ƒ"
    - "åŸºç¡€çŠ¶æ€ç®¡ç†ç³»ç»Ÿ"
    - "ç‰©å“ä½¿ç”¨åŠŸèƒ½"
```

### 2. é…ç½®ç®¡ç†
```javascript
// é…ç½®ç³»ç»Ÿ
class ConfigManager {
    constructor() {
        this.config = this.loadConfig();
        this.applyConfig();
    }
    
    loadConfig() {
        const defaultConfig = {
            auto_save_interval: 300000, // 5åˆ†é’Ÿ
            notifications_enabled: true,
            debug_mode: false,
            ui_theme: 'dark',
            auto_suggestions: true,
            state_validation: true
        };
        
        const savedConfig = TavernHelper.getVariable('sys_config') || {};
        return { ...defaultConfig, ...savedConfig };
    }
    
    applyConfig() {
        // åº”ç”¨è‡ªåŠ¨ä¿å­˜è®¾ç½®
        if (this.config.auto_save_interval > 0) {
            setInterval(() => {
                this.saveGameState();
            }, this.config.auto_save_interval);
        }
        
        // åº”ç”¨è°ƒè¯•æ¨¡å¼
        if (this.config.debug_mode) {
            console.log('è°ƒè¯•æ¨¡å¼å·²å¯ç”¨');
            window.debugPanel = new DebugPanel();
        }
        
        // åº”ç”¨æ™ºèƒ½å»ºè®®
        if (this.config.auto_suggestions) {
            new SmartSuggestionSystem();
        }
    }
    
    saveGameState() {
        const gameState = {
            character: {
                hp: TavernHelper.getVariable('char_hp'),
                mp: TavernHelper.getVariable('char_mp'),
                level: TavernHelper.getVariable('char_level'),
                exp: TavernHelper.getVariable('char_exp'),
                gold: TavernHelper.getVariable('char_gold')
            },
            inventory: TavernHelper.getVariable('inventory_items'),
            status_effects: TavernHelper.getVariable('char_status_effects'),
            timestamp: Date.now()
        };
        
        TavernHelper.setVariable('game_save_state', gameState);
        
        if (this.config.notifications_enabled) {
            console.log('æ¸¸æˆçŠ¶æ€å·²è‡ªåŠ¨ä¿å­˜');
        }
    }
}

// åˆå§‹åŒ–é…ç½®ç®¡ç†å™¨
const configManager = new ConfigManager();
```

è¿™ä¸ªå®Œæ•´çš„0å±‚æ¸¸ç©å®ç°æŒ‡å—æä¾›äº†ï¼š

1. **å®Œæ•´çš„æŠ€æœ¯å®ç°æ–¹æ¡ˆ** - æ¶µç›–æ‰€æœ‰æ ¸å¿ƒç»„ä»¶
2. **è¯¦ç»†çš„ä»£ç ç¤ºä¾‹** - å¯ç›´æ¥ä½¿ç”¨çš„ä»£ç ç‰‡æ®µ
3. **æœ€ä½³å®è·µæŒ‡å¯¼** - é¿å…å¸¸è§é—®é¢˜çš„å»ºè®®
4. **è°ƒè¯•å’Œæµ‹è¯•å·¥å…·** - ç¡®ä¿ç³»ç»Ÿç¨³å®šè¿è¡Œ
5. **éƒ¨ç½²å’Œç»´æŠ¤æ–¹æ¡ˆ** - é•¿æœŸç»´æŠ¤çš„è€ƒè™‘

é€šè¿‡è¿™ä¸ªæŒ‡å—ï¼Œå¼€å‘è€…å¯ä»¥åˆ›å»ºå‡ºçœŸæ­£å®ç°0å±‚æ¸¸ç©ä½“éªŒçš„è§’è‰²å¡ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿäº«å—æµç•…ã€è‡ªåŠ¨åŒ–çš„æ¸¸æˆä½“éªŒã€‚
